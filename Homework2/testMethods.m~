load('Data-Homework-2.mat')
A = data.A;
b = data.b;
lambda = data.lambda;
x0 = data.x0;

N = 500;
epsilon = 0.01;
fOptimal = 23.67;
NormX0MinusXOptimal = 5.4903;% ||x_0 - x^*||

f = @(x)norm(A*x-b)^2+lambda*norm(x,1);


methods = {@subgradient, @smoothedGradient, @smoothedGradientAcc, @proximalGradient, @proximalGradientAcc};
names = {' Subgradient', ' Smoothed Gradient', ' Accelerated Smoothed Gradient', ' Proximal Gradient', ' Accelerated Proximal Gradient'};

n = length(x0);
G = 2*norm(A'*(A*x0-b))+sqrt(n)*lambda;
alpha = 2*epsilon/(G^2);
LSmoothed = 2*normest(A'*A)+lambda/epsilon;

boundSubgradient = @(N)NormX0MinusXOptimal^2/(2*alpha*N) + alpha*G^2/2;
boundSmoothedGradient = @(N)epsilon+LSmoothed*NormX0MinusXOptimal^2/N;
boundSmoothedGradientAcc = @(N)lambda*mu*N+2*L*NormX0MinusXOptimal^2/(N+1)^2;
% boundProximalGradient =
% boundProximalGradientAcc =
% boundInteriorPoint =
% bounds = {applyToColumns(boundSubgradient,1:N+1), applyToColumns(boundSmoothGradient,1:N+1), applyToColumns(boundSmoothGradientAcc,1:N+1), applyToColumns(boundProximalGradient,1:N+1), applyToColumns(boundProximalGradientAcc,1:N+1)};

% Plots (every method except interior point)
for i = 1:length(methods) 
    method = methods{i};
    x = method(A, b, lambda, x0, N, epsilon);
    fx = applyToColumns(f,x);
    figure
    semilogy(1:(N+1),fx-fOptimal) % true convergence
    semilogy(1:(N+1),bounds{i});
    hold on
    title(strcat('Convergence behavior for', names{i}),'FontSize',16)
    xlabel('number of iterations k','Fontsize',16);
    %     if (i==1) %subgradient method
    %         ylabel('$\min\limits_{0 \leki \le N} f(x^{(k)})-f(x^*)$','Interpreter','latex','Fontsize',16);
    %     else
    %         ylabel('$|f(x_k) - f(x^*)|$','Interpreter','latex','Fontsize',16);
    %     end
    legend('true convergence', 'theoretical convergence');
end

% [~, fx] = interiorPoint(A, b, lambda);
% figure
% semilogy(1:length(fx),fx-fOptimal) % true convergence
% hold on
% %Plot Bound
% title('Convergence behavior for interior point','FontSize',16)
% xlabel('number of iterations k','Fontsize',16);
% legend('true convergence', 'theoretical convergence');